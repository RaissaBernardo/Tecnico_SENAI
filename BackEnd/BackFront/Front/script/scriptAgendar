async function carregarMedicos() {
  console.log("üì¶ Carregando m√©dicos...");

  const select = document.getElementById('medicoSelect');
  const mensagem = document.getElementById('mensagem');

  if (!select || !mensagem) {
    console.error("‚ùå Elementos do DOM n√£o encontrados!");
    return;
  }

  try {
    const res = await fetch('http://localhost:8080/medicos');

    if (!res.ok) throw new Error(`Erro ao buscar m√©dicos: ${res.status}`);

    const medicos = await res.json();

    medicos.forEach(medico => {
      const option = document.createElement('option');
      option.value = medico.cpf;
      option.textContent = `${medico.nome} - ${medico.especialidade}`;
      select.appendChild(option);
    });

  } catch (err) {
    console.error("‚ùå Erro ao carregar m√©dicos:", err);
    mensagem.textContent = "Erro ao carregar m√©dicos.";
  }
}

async function agendarConsulta() {
  const cpfPaciente = document.getElementById('cpfPaciente')?.value.trim();
  const cpfMedico = document.getElementById('medicoSelect')?.value;
  const dataHora = document.getElementById('dataHora')?.value;
  const observacoes = document.getElementById('observacoes')?.value;
  const mensagem = document.getElementById('mensagem');
  const form = document.getElementById('formAgendamento');

  if (!cpfPaciente || !cpfMedico || !dataHora || !mensagem || !form) {
    if (mensagem) mensagem.textContent = "‚ö†Ô∏è Preencha todos os campos obrigat√≥rios.";
    return;
  }

  const consulta = {
    pacienteCpf: cpfPaciente,
    medicoCpf: cpfMedico,
    dataHora,
    observacoes
  };

  console.log("üì§ Enviando agendamento:", consulta);

  try {
    const res = await fetch('http://localhost:8080/consultas', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(consulta)
    });

    if (!res.ok) throw new Error(`Erro ao agendar consulta: ${res.status}`);

    await res.json();

    mensagem.textContent = "‚úÖ Consulta agendada com sucesso!";
    form.reset();
  } catch (err) {
    console.error("‚ùå Erro ao agendar:", err);
    mensagem.textContent = "‚ùå N√£o foi poss√≠vel agendar. Verifique os dados e tente novamente.";
  }
}

function main() {
  carregarMedicos();

  const form = document.getElementById('formAgendamento');
  if (form) {
    form.addEventListener('submit', e => {
      e.preventDefault();
      agendarConsulta();
    });
  } else {
    console.warn("‚ùå Formul√°rio de agendamento n√£o encontrado!");
  }
}

document.addEventListener('DOMContentLoaded', main);
